-- SETUP INSTRUCTIONS
-- Complete guide to migrate your Neovim config to modern vim.* APIs

================================================================================
STEP-BY-STEP INSTALLATION GUIDE
================================================================================

1. BACKUP YOUR CURRENT CONFIGURATION
   -----------------------------------
   Before making changes, backup your existing config:
   
   $ cp -r ~/.config/nvim ~/.config/nvim.backup
   
   This allows you to revert if something goes wrong.

2. CREATE NEW DIRECTORY STRUCTURE
   --------------------------------
   Create the following directories:
   
   $ mkdir -p ~/.config/nvim/lua/config
   $ mkdir -p ~/.config/nvim/lua/utils
   
   Your final structure should be:
   
   ~/.config/nvim/
   â”œâ”€â”€ init.lua                    â† Your main nvim entry point
   â”œâ”€â”€ lua/
   â”‚   â”œâ”€â”€ config/
   â”‚   â”‚   â”œâ”€â”€ init.lua            â† Config loader (new)
   â”‚   â”‚   â”œâ”€â”€ mason.lua           â† Mason setup (new)
   â”‚   â”‚   â”œâ”€â”€ lspconfig.lua       â† LSP setup (new)
   â”‚   â”‚   â”œâ”€â”€ keymaps.lua         â† Keymaps (new)
   â”‚   â”‚   â””â”€â”€ diagnostics.lua     â† Diagnostics (new)
   â”‚   â”œâ”€â”€ utils/
   â”‚   â”‚   â””â”€â”€ helpers.lua         â† Helper functions (new)

3. COPY THE NEW FILES
   -------------------
   Copy each provided Lua file to its location:
   
   Files provided:
   â€¢ init_main.lua              â†’ ~/.config/nvim/init.lua
   â€¢ config_init.lua            â†’ ~/.config/nvim/lua/config/init.lua
   â€¢ config_mason.lua           â†’ ~/.config/nvim/lua/config/mason.lua
   â€¢ config_lspconfig.lua       â†’ ~/.config/nvim/lua/config/lspconfig.lua
   â€¢ config_keymaps.lua         â†’ ~/.config/nvim/lua/config/keymaps.lua
   â€¢ config_diagnostics.lua     â†’ ~/.config/nvim/lua/config/diagnostics.lua
   â€¢ utils_helpers.lua          â†’ ~/.config/nvim/lua/utils/helpers.lua

4. REPLACE YOUR init.lua
   ----------------------
   Your current init.lua:
   
   print("trying to load mason")
   require("mason_config")
   print('loaded mason')
   require("lsp-format").setup {}
   require("lsp_config")
   
   âœ… REPLACE with init_main.lua content
   
   The new init.lua is much simpler:
   
   vim.opt.runtimepath:append(vim.fn.stdpath("config") .. "/lua")
   require("config.init")

5. ADJUST PATHS IN config_lspconfig.lua
   ------------------------------------
   Find this line:
   
   file = "/home/tkhunlertkit/efmlog.txt",  -- Adjust path as needed
   
   Change it to your home directory or remove if not needed.

6. TEST THE CONFIGURATION
   ----------------------
   Start Neovim and check for errors:
   
   $ nvim --headless "+q"
   
   Or start normally and check messages:
   
   $ nvim
   
   Then run:
   
   :messages           â† View startup messages
   :LspInfo            â† Check LSP status
   :Mason              â† Check installed servers

7. VERIFY EVERYTHING WORKS
   -------------------------
   Test these features:
   
   a) Mason & Language Servers:
      - Run :Mason to open the package manager
      - Verify: pyright, ts_ls, lua_ls, efm are listed
   
   b) LSP Keymaps:
      - Open a Python or TypeScript file
      - Try 'gd' to go to definition
      - Try 'K' to see hover documentation
   
   c) Diagnostics:
      - Create a syntax error in any file
      - Verify error appears with icon and underline
      - Try '[d' and ']d' to navigate errors
   
   d) Formatting:
      - Try '<leader>f' to format the file
      - Should use black for Python, prettier for JS/TS

8. TROUBLESHOOTING
   ----------------
   
   Issue: "Mason is not installed"
   Solution: Ensure mason.nvim is installed via your package manager
   
   Issue: Language servers not showing up in :Mason
   Solution: Run :MasonInstall pyright ts_ls lua_ls efm
   
   Issue: LSP keymaps not working
   Solution: Verify you have a language server file open
              Run :LspInfo to check if server is attached
   
   Issue: Formatting doesn't work
   Solution: Verify formatters are installed:
            - Python: black, isort
            - Lua: lua-format
            - TypeScript: prettier

================================================================================
COMPARISON: OLD vs NEW
================================================================================

OLD CONFIGURATION (require-based):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

init.lua:
  print("trying to load mason")
  require("mason_config")
  require("lsp-format").setup {}
  require("lsp_config")

Problems:
  âœ— Scattered across multiple files
  âœ— Hard to understand loading order
  âœ— Debug print statements
  âœ— Mixed concerns (config + loading logic)
  âœ— Difficult to maintain


NEW CONFIGURATION (vim.*-based):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

init.lua:
  vim.opt.runtimepath:append(vim.fn.stdpath("config") .. "/lua")
  require("config.init")

config/init.lua:
  -- All loading logic centralized with error handling
  -- Clear loading order documented
  -- Using vim.notify instead of print()
  -- Each module has single responsibility

Benefits:
  âœ“ Clean separation of concerns
  âœ“ Clear loading order
  âœ“ Better error handling
  âœ“ Easier to debug
  âœ“ Follows Neovim conventions
  âœ“ More maintainable long-term

================================================================================
KEY DIFFERENCES EXPLAINED
================================================================================

1. LOADING PATTERN
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   OLD:
     require("module_name")          â† Just load it, unclear when
   
   NEW:
     require("config.init")           â† Single entry point
     which loads in specific order:
       1. diagnostics
       2. mason
       3. lspconfig
       4. keymaps
       5. utils
   
   This order is critical! LSP must be setup before keymaps.

2. ERROR HANDLING
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   OLD:
     require("something") â†’ Crashes if module doesn't exist
   
   NEW:
     safe_require(module) â†’ Returns nil and notifies user
   
   The safe_require function prevents crashes.

3. USER FEEDBACK
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   OLD:
     print("loaded mason")            â† Goes to Neovim console
   
   NEW:
     vim.notify("âœ“ Mason configured") â† Shows in notification area
                                        Appears at bottom right

4. MODULAR STRUCTURE
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   OLD:
     All settings in one big file
     Hard to find specific settings
   
   NEW:
     config/
       â”œâ”€â”€ mason.lua          â† Only mason settings
       â”œâ”€â”€ lspconfig.lua      â† Only LSP settings
       â”œâ”€â”€ keymaps.lua        â† Only keymaps
       â””â”€â”€ diagnostics.lua    â† Only diagnostics
   
   Much easier to navigate!

================================================================================
CUSTOMIZATION EXAMPLES
================================================================================

Example 1: Add a new language server (Go)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
File: lua/config/mason.lua
Find: ensure_installed = { "pyright", "ts_ls", "lua_ls", "efm" }
Add:  "gopls"

File: lua/config/lspconfig.lua
Add:  lspconfig.gopls.setup({
        on_attach = on_attach_default,
      })


Example 2: Change diagnostic display
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
File: lua/config/diagnostics.lua
Modify the icons table:

local signs = {
  Error = "E",   â† Change from "âŒ"
  Warn = "W",    â† Change from "âš ï¸"
  Hint = "H",    â† Change from "ğŸ’¡"
  Info = "I",    â† Change from "â„¹ï¸"
}


Example 3: Change keymaps
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
File: lua/config/keymaps.lua
Find: buf_keymap("n", "gd", vim.lsp.buf.definition, "Go to definition")
Change "gd" to your preferred key, e.g., "gd" â†’ "gD"


Example 4: Add custom formatting for new language
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
File: lua/config/lspconfig.lua
Find: languages = { ... }
Add:

rust = {
  { formatCommand = "rustfmt", formatStdin = true },
},

================================================================================
MIGRATION CHECKLIST
================================================================================

Before migration:
  â˜ Backup your current nvim config to ~/.config/nvim.backup
  â˜ Ensure all plugins are installed (mason, lspconfig, lsp-format)
  â˜ Note any custom settings you want to preserve

During migration:
  â˜ Create directory structure (lua/config, lua/utils)
  â˜ Copy all 7 Lua files to correct locations
  â˜ Replace init.lua with new version
  â˜ Adjust paths (especially efmlog.txt path)
  â˜ Test with: nvim --headless "+q"

After migration:
  â˜ Check :messages for errors
  â˜ Verify :LspInfo shows expected servers
  â˜ Test keymaps in each language file
  â˜ Confirm formatting works (<leader>f)
  â˜ Test diagnostic navigation ([d, ]d)
  â˜ Verify all your previous customizations work

If something breaks:
  â˜ Check error messages: :messages
  â˜ Try restarting Neovim
  â˜ Run :checkhealth
  â˜ Check plugin installation: :Mason
  â˜ Restore from backup if needed: cp -r ~/.config/nvim.backup ~/.config/nvim

================================================================================
SUPPORT & REFERENCES
================================================================================

Official Documentation:
  â€¢ Neovim LSP: https://neovim.io/doc/user/lsp.html
  â€¢ vim.diagnostic: :help vim.diagnostic
  â€¢ vim.lsp: :help vim.lsp
  â€¢ vim.keymap: :help vim.keymap.set()

Plugin Repositories:
  â€¢ lspconfig: https://github.com/neovim/nvim-lspconfig
  â€¢ mason.nvim: https://github.com/williamboman/mason.nvim
  â€¢ lsp-format: https://github.com/lukas-reineke/lsp-format.nvim

In-Editor Help:
  :LspInfo               â† View active LSP clients
  :LspRestart            â† Restart all LSP servers
  :Mason                 â† Open package manager
  :checkhealth           â† Check plugin health
  :messages              â† View recent messages
  :help lsp              â† LSP documentation

================================================================================
